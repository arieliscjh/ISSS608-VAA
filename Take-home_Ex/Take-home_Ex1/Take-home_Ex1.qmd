---
title: "Take-home_Ex1"
date: "January 13,2024"
date-modified: "last-modified"
execute: 
  eval: true 
  echo: true
  warning: false
editor: visual 
---

# Project Brief

"Singapore managed to achieve excellence without wide differences between children from wealthy and disadvantaged families," said OECD education director Andreas Schleicher in a BBC piece. However, the general public, however, is adamant that there are still differences between educational attainment and socioeconomic position.

This project will explore multiple possible factors that could help to verify and investigate the statement further, utilizing the proper R statistical graphics techniques, both interactive and static.

# Project Objective

This project aims to assess if there still social difference among different background of families. Students' performance on math, reading and science will be the main metrics. The effects brought by school, gender and socioeconomic status on student's academic performance will be tested in this project. Besides, the socioeconomic status will be demonstrated through number of digital devices, number of musical instruments, and food availability.

# 1: Data Preparation

## 1.1 Loading R package

The code chunck used is as follows:

```{r}
pacman::p_load(tidyverse,haven,ggrepel, patchwork, ggthemes, hrbrthemes, ggrain)
```

## 1.2 Dataset

### 1.2.1 Import the datasets

```{r}
#| eval: false
stu_qqq <-read_sas("data/cy08msp_stu_qqq.sas7bdat")
```

```{r}
#| eval: false
stu_qqq_SG <-stu_qqq %>%
  filter(CNT == "SGP")
```

```{r}
#| eval: false
write_rds(stu_qqq_SG,
          "data/stu_qqq_SG.rds")
```

```{r}
stu_qqq_SG <- 
read_rds("data/stu_qqq_SG.rds")
```

### 1.2.2 Summary Statistics of Stu_qqq_data

::: panel-tabset
## Dataset Overview

```{r}
str(stu_qqq_SG)
```

```{r}
glimpse(stu_qqq_SG)
```

## Data Checking

Duplicates

```{r}
stu_qqq_SG[duplicated(stu_qqq_SG),]
```

Missing Values

```{r}
sum(is.na(stu_qqq_SG))
```
:::

# 2. Data Wrangling

## 2.1 Select Useful Columns

```{r}
stu_qqq_eda<-stu_qqq_SG %>%
  select(CNTSCHID,CNTSTUID,ST004D01T,ST253Q01JA,ST258Q01JA, ST251Q06JA, PV1MATH, PV1READ, PV1SCIE)%>%
  rename(c(Gender="ST004D01T", 
           School_ID="CNTSCHID", 
           Num_DigitalDevice='ST253Q01JA',
           Food_Availability='ST258Q01JA',
           Num_MusicalInstruments='ST251Q06JA', 
           Student_ID='CNTSTUID',
           Math_Score= "PV1MATH",
           Reading_Score="PV1READ",
           Science_Score="PV1SCIE"))
```

## 2.2 Change Data Types

```{r}
stu_qqq_eda$School_ID = as.factor(stu_qqq_eda$School_ID)
stu_qqq_eda$Gender = as.factor(stu_qqq_eda$Gender)
stu_qqq_eda$Num_DigitalDevice = as.factor(stu_qqq_eda$Num_DigitalDevice)
stu_qqq_eda$Food_Availability = as.factor(stu_qqq_eda$Food_Availability)
stu_qqq_eda$Num_MusicalInstruments= as.factor(stu_qqq_eda$Num_MusicalInstruments)
```

## 2.3 Recode variable

```{r}
stu_qqq_eda <- stu_qqq_eda %>%
  mutate(Gender=(recode(Gender, '1'="Female", '2'="Male")))
```

# 3. Exploratory Data Analysis

## 3.1 Students Performance

## 3.1.1 Performance Distribution

::: panel-tabset
## Math

```{r}
#| code-fold: true
#| code-summary: "Show code"
ggplot(data=stu_qqq_eda, 
       aes(x=Math_Score)) +
  geom_histogram(color= "grey10",
           fill= '#FFC0CB') +
  labs(x= "Math_Score",
       y="No.of students",
       title= "Distribution of Student Math Performance") +
  geom_vline(aes(xintercept=median(stu_qqq_eda$Math_Score, na.rm = T)), 
             color="#595DE5", 
             linewidth=1, 
             linetype="dashed") + 
  annotate("text", 
           x=675, 
           y=70, 
           label= paste("Median =", round(median(stu_qqq_eda$Math_Score, na.rm = T), 3)), 
           color= "#595DE5", 
           size=3.5) +
  geom_vline(aes(xintercept=mean(stu_qqq_eda$Math_Score, na.rm = T)),
             colour="red",
             linewidth=1,
             linetype="dashed") +
  annotate("text",
           x=500,
           y=20,
           label=paste("Mean =", round(mean(stu_qqq_eda$Math_Score, na.rm = T), 3)),
           color="red",
           size=3.5) +
  theme(plot.background=element_rect(fill="#f5f5f5",colour="#f5f5f5"))
```

## Reading

```{r}
#| code-fold: true
#| code-summary: "Show code"
ggplot(data=stu_qqq_eda, 
       aes(x=Reading_Score)) +
  geom_histogram(color= "grey10",
           fill= '#FFC0CB') +
  labs(x= "Reading_Score",
       y="No.of students",
       title= "Distribution of Student Reading Performance") +
  geom_vline(aes(xintercept=median(stu_qqq_eda$Reading_Score, na.rm = T)), 
             color="#595DE5", 
             linewidth=1, 
             linetype="dashed") + 
  annotate("text", 
           x=650, 
           y=60, 
           label= paste("Median =", round(median(stu_qqq_eda$Reading_Score, na.rm = T), 3)), 
           color= "#595DE5", 
           size=3.5) +
  geom_vline(aes(xintercept=mean(stu_qqq_eda$Reading_Score, na.rm = T)),
             colour="red",
             linewidth=1,
             linetype="dashed") +
  annotate("text",
           x=460,
           y=50,
           label=paste("Mean =", round(mean(stu_qqq_eda$Reading_Score, na.rm = T), 3)),
           color="red",
           size=3.5) +
  theme(plot.background=element_rect(fill="#f5f5f5",colour="#f5f5f5"))
```

## Science

```{r}
#| code-fold: true
#| code-summary: "Show code"
ggplot(data=stu_qqq_eda, 
       aes(x=Science_Score)) +
  geom_histogram(color= "grey10",
           fill= '#FFC0CB') +
  labs(x= "Science_Score",
       y="No.of students",
       title= "Distribution of Student Science Performance") +
  geom_vline(aes(xintercept=median(stu_qqq_eda$Science_Score, na.rm = T)), 
             color="#595DE5", 
             linewidth=1, 
             linetype="dashed") + 
  annotate("text", 
           x=650, 
           y=60, 
           label= paste("Median =", round(median(stu_qqq_eda$Science_Score, na.rm = T), 3)), 
           color= "#595DE5", 
           size=3.5) +
  geom_vline(aes(xintercept=mean(stu_qqq_eda$Science_Score, na.rm = T)),
             colour="red",
             linewidth=1,
             linetype="dashed") +
  annotate("text",
           x=480,
           y=50,
           label=paste("Mean =", round(mean(stu_qqq_eda$Science_Score, na.rm = T), 3)),
           color="red",
           size=3.5) +
  theme(plot.background=element_rect(fill="#f5f5f5",colour="#f5f5f5"))
```
:::

## 3.1.2 Are there difference in student performance between gender ?

### Distribution

```{r}
ggplot(data = stu_qqq_eda,
       aes(x = Gender)) +
  geom_bar()
```

::: panel-tabset
## Math

```{r}
#| code-fold: true
#| code-summary: "Show code"
ggplot(data=stu_qqq_eda, 
       aes(x=Math_Score,
           fill = Gender)) +
  geom_histogram(bins = 10,
                 position= "dodge",
                 color="grey10") +
  scale_fill_manual(values = c("#F98B88", "#F5FFFA")) +
  scale_y_continuous(breaks = seq(0, 3200, by = 500)) +
  scale_x_continuous(breaks = seq(0, 1000, by = 100)) +
  ylim(c(0,1000)) +
  stat_bin(bins = 10,
           geom = "text",
           aes(label = after_stat(count)),
           vjust = -.5, size=2.5,
           position = position_dodge())
```

## Reading

```{r}
#| code-fold: true
#| code-summary: "Show code"
ggplot(data=stu_qqq_eda, 
       aes(x=Reading_Score,
           fill = Gender)) +
  geom_histogram(bins = 10,
                 position= "dodge",
                 color="grey10") +
  scale_fill_manual(values = c("#F98B88", "#F5FFFA")) +
  scale_y_continuous(breaks = seq(0, 3200, by = 500)) +
  scale_x_continuous(breaks = seq(0, 1000, by = 100)) +
  ylim(c(0,1000)) +
  stat_bin(bins = 10,
           geom = "text",
           aes(label = after_stat(count)),
           vjust = -.5, size= 2.5,
           position = position_dodge())
```

## Science

```{r}
#| code-fold: true
#| code-summary: "Show code"
ggplot(data=stu_qqq_eda, 
       aes(x= Science_Score,
           fill = Gender)) +
  geom_histogram(bins = 10,
                 position= "dodge",
                 color="grey10") +
  scale_fill_manual(values = c("#F98B88", "#F5FFFA")) +
  scale_y_continuous(breaks = seq(0, 3200, by = 500)) +
  scale_x_continuous(breaks = seq(0, 1000, by = 100)) +
  ylim(c(0,1000)) +
  stat_bin(bins = 10,
           geom = "text",
           aes(label = after_stat(count)),
           vjust = -.5, size= 2.5,
           position = position_dodge())
```
:::

## 3.1.3 Are there difference in student performance among various schools?

### Distribution

```{r}
stu_avg_score <- stu_qqq_eda %>%
  group_by(School_ID) %>%
  mutate(math_avg = mean(Math_Score),
         science_avg = mean(Science_Score),
         reading_avg = mean(Reading_Score)) %>%
  select(School_ID, math_avg, science_avg, reading_avg) %>%
  unique() 
```

::: panel-tabset
## Math

```{r}
ggplot(data=stu_avg_score,
       aes(x= math_avg)) +
  geom_boxplot(width=0.1) +
  geom_point(aes(y= -0.1), position= position_jitter(width = 0.1, height = 0), color = "red", alpha = 0.5) +
  ylim(c(-.1,.1)) +
  scale_y_continuous(NULL, breaks = NULL)
  labs(x= "Math Average among schools", y= NULL)

```

## Science

```{r}
ggplot(data=stu_avg_score,
       aes(x= science_avg)) +
  geom_boxplot(width=0.1) +
  geom_point(aes(y= -0.1), position= position_jitter(width = 0.1, height = 0), color = "red", alpha = 0.5) +
  ylim(c(-.1,.1)) +
  scale_y_continuous(NULL, breaks = NULL)
  labs(x= "Science Average among schools", y= NULL)
```

## Reading

```{r}
ggplot(data=stu_avg_score,
       aes(x= reading_avg)) +
  geom_boxplot(width=0.1) +
  geom_point(aes(y= -0.1), position= position_jitter(width = 0.1, height = 0), color = "red", alpha = 0.5) +
  ylim(c(-.1,.1)) +
  scale_y_continuous(NULL, breaks = NULL)
  labs(x= "Reading Average among schools", y= NULL)
```
:::

## 3.1.4 Socioeconomic Status

## I. Will number of digital devices affect student performance ?

### Distribution 

```{r}
ggplot(data = stu_qqq_eda,
       aes(x = Num_DigitalDevice)) +
  geom_bar()
```

```{r}
cleaned_stu_qqq_eda <- na.omit(stu_qqq_eda)
```

::: panel-tabset
## Math

```{r}
ggplot(data = cleaned_stu_qqq_eda, aes(x = factor(Num_DigitalDevice), y = Math_Score)) +
  geom_boxplot() +
  labs(x = "Number of Digital Devices", y = "Math Score") +
  ggtitle("Distribution of Math Scores for Each Number of Devices")

```

## Reading

```{r}
ggplot(data = cleaned_stu_qqq_eda, aes(x = factor(Num_DigitalDevice), y = Reading_Score)) +
  geom_boxplot() +
  labs(x = "Number of Digital Devices", y = "Math Score") +
  ggtitle("Distribution of Reading score for Each Number of Devices")
```

## Science

```{r}
ggplot(data = cleaned_stu_qqq_eda, aes(x = factor(Num_DigitalDevice), y = Science_Score)) +
  geom_boxplot() +
  labs(x = "Number of Digital Devices", y = "Math Score") +
  ggtitle("Distribution of Science Scores for Each Number of Devices")
```
:::

## II. Will number of musical instruments affect student performance ?

### Distribution 

```{r}
ggplot(data = stu_qqq_eda,
       aes(x = Num_MusicalInstruments)) +
  geom_bar()
```

::: panel-tabset
## Math 

```{r}
ggplot(data = cleaned_stu_qqq_eda, aes(x = factor(Num_MusicalInstruments), y = Math_Score)) +
  geom_bar(stat = "summary", fun = "mean") +
  labs(x = "Number of Musical Instruments", y = "Mean Math Score") +
  ggtitle("Mean Math Score for Each Number of Instruments")
```

## Reading

```{r}
ggplot(data = cleaned_stu_qqq_eda, aes(x = factor(Num_MusicalInstruments), y = Reading_Score)) +
  geom_bar(stat = "summary", fun = "mean") +
  labs(x = "Number of Musical Instruments", y = "Mean Reading Score") +
  ggtitle("Mean Reading Score for Each Number of Instruments")
```

## Science

```{r}
ggplot(data = cleaned_stu_qqq_eda, aes(x = factor(Num_MusicalInstruments), y = Science_Score)) +
  geom_bar(stat = "summary", fun = "mean") +
  labs(x = "Number of Musical Instruments", y = "Mean Math Score") +
  ggtitle("Mean Math Score for Each Number of Instruments")
```
:::

## III. Will food availability affect student performance ?

### Distribution 

```{r}
ggplot(data = stu_qqq_eda,
       aes(x = Food_Availability)) +
  geom_bar()
```

::: panel-tabset
## Math

```{r}
ggplot(data = cleaned_stu_qqq_eda, aes(x = factor(Food_Availability), y = Math_Score)) +
  geom_violin() +
  labs(x = "Degree of Food Availability", y = "Math Score") +
  ggtitle("Distribution of Math Scores for Each level of Food Availability") +
  stat_summary(fun = "mean",
               geom = "point",
               color = "blue")

```

## Reading

```{r}
ggplot(data = cleaned_stu_qqq_eda, aes(x = factor(Food_Availability), y = Reading_Score)) +
  geom_violin() +
  labs(x = "Degree of Food Availability", y = "Reading Score") +
  ggtitle("Distribution of Reading Scores for Each level of Food Availability") +
  stat_summary(fun = "mean",
               geom = "point",
               color = "blue")

```

## Science

```{r}
ggplot(data = cleaned_stu_qqq_eda, aes(x = factor(Food_Availability), y = Science_Score)) +
  geom_violin() +
  labs(x = "Degree of Food Availability", y = "Science Score") +
  ggtitle("Distribution of Science Scores for Each level of Food Availability") +
  stat_summary(fun = "mean",
               geom = "point",
               color = "blue")
```
:::
